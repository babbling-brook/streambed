"object"!=typeof BabblingBrook&&(BabblingBrook={}),"object"!=typeof BabblingBrook.Public&&(BabblingBrook.Public={}),BabblingBrook.Public.Login=function(){"use strict";var e=function(){var e=(document.getElementById("page"),document.querySelector("#page #login_help")),n=document.querySelector("#page #login_help_text");null!==e&&(e.onclick=function(){return n.className="hide"===n.className?"content-block-2 readable-text":"hide",!1})},n=function(e,n,o){if(4===e.readyState){if(200!==e.status)return void console.error("Error whilst checking an activation code is valid.");var r=e.responseText;if("&&&BABBLINGBROOK&&&"!==r.substr(0,19))throw"JSON response data does not have a valid token to prevent JSON hijacking.";var i=r.substr(19),a=JSON.parse(i);if(a.valid===!0)t(n,o);else{var l=document.getElementById("signup_code_error");l.className="error"}}},o=function(e,o){document.getElementById("client_login").className="hide",document.getElementById("request_signup_code").className="content-indent";var t=new XMLHttpRequest;document.getElementById("signup_code_submit").onclick=function(){t.onreadystatechange=n.bind(null,t,e,o),t.open("POST","/site/loginchecksignupcode",!0),t.setRequestHeader("Content-Type","application/x-www-form-urlencoded");var r=document.getElementById("signup_code").value;t.send("full_username="+e+"&signup_code="+r)}},t=function(e,n){var o="https://"+window.location.host+"/site/loginredirect?username="+encodeURIComponent(e)+"&return_location="+encodeURIComponent(n);window.location=o},r=function(e){var n=document.querySelector(e+" #username");i=n.value;var r=document.querySelector(e+" #login_error"),i="",a=new XMLHttpRequest,l=encodeURI(window.location.href);"/site/login"===window.location.pathname.substr(0,11)&&(l=""),r.className="hide",n.className="textbox-loading",a.onreadystatechange=function(){if(4===a.readyState){if(200!==a.status)return void console.error("Error whilst checking a username is valid.");var e=a.responseText;if("&&&BABBLINGBROOK&&&"!==e.substr(0,19))throw"JSON response data does not have a valid token to prevent JSON hijacking.";var s=e.substr(19),c=JSON.parse(s);if(c.exists===!0)c.signup_code_status===!1?o(i,l):t(i,l);else{var u="Username not found.";"string"==typeof c.error_message&&(u=c.error_message),r.innerHTML=u,n.className="",r.className="error"}}},a.open("POST","/site/logincheckusername",!0),a.setRequestHeader("Content-Type","application/x-www-form-urlencoded"),i=n.value,a.send("full_username="+i)},i=function(){var e=window.location.hash.substring(1);if("helpopen"===e){var n=document.querySelector("#page #login_help_text");n.className="content-block-2 readable-text"}var o=document.querySelector("#content .loggin-button");null!==o&&(o.onclick=r.bind(null,"#content")),document.querySelector("#login-modal .loggin-button").onclick=r.bind(null,"#login-modal")},a=function(){return"undefined"==typeof window.XMLHttpRequest||null===window.XMLHttpRequest?!1:"undefined"==typeof localStorage||null===localStorage?!1:"undefined"==typeof window.postMessage||null===window.postMessage?!1:!0};return{construct:function(){if(a()===!1){var n=document.getElementById("ok_browser");n.parentNode.removeChild(n);var o=document.getElementById("bad_browser");return void(o.className="")}i(),e()}}}(),window.onload=function(){"use strict";"undefined"==typeof BabblingBrook.Client&&(BabblingBrook.Public.Login.construct(),BabblingBrook.Public.Resize.construct(),document.getElementById("login_constructor_has_run").value="true")};
//# sourceMappingURL=/js/Minified/Public/Login.js.map