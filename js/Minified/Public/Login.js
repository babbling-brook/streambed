"object"!=typeof BabblingBrook&&(BabblingBrook={}),"object"!=typeof BabblingBrook.Public&&(BabblingBrook.Public={}),BabblingBrook.Public.Login=function(){"use strict";var e=function(){var e=(document.getElementById("page"),document.querySelector("#page #login_help")),n=document.querySelector("#page #login_help_text");null!==e&&(e.onclick=function(){return n.className="hide"===n.className?"content-block-2 readable-text":"hide",!1})},n=function(e,n,t){if(4===e.readyState){if(200!==e.status)return void console.error("Error whilst checking an activation code is valid.");var r=e.responseText;if("&&&BABBLINGBROOK&&&"!==r.substr(0,19))throw"JSON response data does not have a vlaid token to prevent JSON hijacking.";var a=r.substr(19),i=JSON.parse(a);if(i.valid===!0)o(n,t);else{var s=document.getElementById("signup_code_error");s.className="error"}}},t=function(e,t){document.getElementById("client_login").className="hide",document.getElementById("request_signup_code").className="content-indent";var o=new XMLHttpRequest;document.getElementById("signup_code_submit").onclick=function(){o.onreadystatechange=n.bind(null,o,e,t),o.open("POST","/site/loginchecksignupcode",!0),o.setRequestHeader("Content-Type","application/x-www-form-urlencoded");var r=document.getElementById("signup_code").value;o.send("full_username="+e+"&signup_code="+r)}},o=function(e,n){var t="https://"+window.location.host+"/site/loginredirect?username="+encodeURIComponent(e)+"&return_location="+encodeURIComponent(n);window.location=t},r=function(){var e=document.getElementById("username"),n=document.getElementById("login_error"),r="",a=new XMLHttpRequest,i=window.location.hash.substring(1);if("helpopen"===i){var s=document.querySelector("#page #login_help_text");s.className="content-block-2 readable-text"}document.getElementById("login_submit").onclick=function(){r=e.value;var i=encodeURI(window.location.href);"/site/login"===window.location.pathname.substr(0,11)&&(i=""),n.className="hide",e.className="textbox-loading",a.onreadystatechange=function(){if(4===a.readyState){if(200!==a.status)return void console.error("Error whilst checking a username is valid.");var s=a.responseText;if("&&&BABBLINGBROOK&&&"!==s.substr(0,19))throw"JSON response data does not have a vlaid token to prevent JSON hijacking.";var c=s.substr(19),l=JSON.parse(c);if(l.exists===!0)l.signup_code_status===!1?t(r,i):o(r,i);else{var u="Username not found.";"string"==typeof l.error_message&&(u=l.error_message),n.innerHTML=u,e.className="",n.className="error"}}},a.open("POST","/site/logincheckusername",!0),a.setRequestHeader("Content-Type","application/x-www-form-urlencoded"),r=e.value,a.send("full_username="+r)}},a=function(){return"undefined"==typeof window.XMLHttpRequest||null===window.XMLHttpRequest?!1:"undefined"==typeof localStorage||null===localStorage?!1:"undefined"==typeof window.postMessage||null===window.postMessage?!1:!0};return{construct:function(){if(a()===!1){var n=document.getElementById("ok_browser");n.parentNode.removeChild(n);var t=document.getElementById("bad_browser");return void(t.className="")}r(),e()}}}(),window.onload=function(){"use strict";"undefined"==typeof BabblingBrook.Client&&(BabblingBrook.Public.Login.construct(),BabblingBrook.Public.Resize.construct(),document.getElementById("login_constructor_has_run").value="true")};
//# sourceMappingURL=/js/Minified/Public/Login.js.map