"object"!=typeof BabblingBrook.Client.Page.Settings&&(BabblingBrook.Client.Page.Settings={}),BabblingBrook.Client.Page.Settings.Settings=function(){"use strict";var e,n=function(e){console.error("There is an error in the users config settings. The extra_data is missing the rhythm_cat data."),console.log(e)},r=function(e){var n=jQuery("#config_row_template").children().clone();return n.append(e),n},t=function(e,n){jQuery("label",n).text(e.name),jQuery(".config-value",n).val(BabblingBrook.Client.User.Config[e.code]),jQuery(".help-icon",n).attr("id","help_config"+e.code),jQuery(".help-title",n).attr("id","help_title_config"+e.code).text(e.name),jQuery(".help-content",n).attr("id","help_content_config"+e.code).text(e.description),jQuery(".config-display-order",n).val(e.code),jQuery(".config-code",n).val(e.code),"undefined"!=typeof BabblingBrook.Client.User.Config[e.code]&&BabblingBrook.Client.User.Config[e.code].toString()!==e.value.toString()&&jQuery(".config-value",n).addClass("custom"),jQuery("#config_options").append(n)},o=function(e){var n=jQuery("#config_row_uint_template").children().clone(),o=r(n);t(e,o)},i=function(e){var n=jQuery("#config_row_stream_template").children().clone(),o=r(n);o.addClass("stream-url"),t(e,o)},a=function(){jQuery(".stream-url>.search>a").click(function(){var e=jQuery(this),n=e.parent().parent().find(".stream-selector"),r=e.parent().parent().find(".config-value");if(n.is(":visible"))return n.slideUp(250,function(){e.text("search"),n.empty()}),!1;{var t=e.parent().parent().find(".config-display-order").val(),o=[{name:"Select",onClick:function(t,o,i){t.preventDefault();var a=BabblingBrook.Library.makeStreamUrl(i,"json");r.val(a),n.slideUp(250,function(){e.text("search"),n.empty(),r.trigger("blur")})}}];new BabblingBrook.Client.Component.Selector("stream","config_stream_"+t,n,o,{})}return e.text("close search"),n.slideDown(250).removeClass("hide"),!1})},o=function(e){var n=jQuery("#config_row_uint_template").children().clone(),o=r(n);t(e,o)},l=function(e){var n=jQuery("#config_row_string_template").children().clone(),o=r(n);t(e,o)},c=function(e){if(null===e.extra_data||"undefined"==typeof e.extra_data.rhythm_cat)return void n(e);var o=jQuery("#config_row_rhythm_template").children().clone(),i=r(o);i.addClass("rhythm-url"),t(e,i)},s=function(n){var r;return jQuery.each(e,function(e,t){return t.code===n?void(r=t.extra_data):void 0}),r},u=function(n){var r;return jQuery.each(e,function(e,t){return t.code===n?void(r=t.value):void 0}),r},d=function(){jQuery(".rhythm-url>.search>a").click(function(){var e=jQuery(this),n=e.parent().parent().find(".rhythm-selector"),r=e.parent().parent().find(".config-value");if(n.is(":visible"))return n.slideUp(250,function(){e.text("search"),n.empty()}),!1;{var t=e.parent().parent().find(".config-code").val(),o=s(t),i=(BabblingBrook.Client.User.Config[t],[{name:"Select",onClick:function(t,o,i){t.preventDefault();var a=BabblingBrook.Library.makeRhythmUrl(i,"json");r.val(a),n.slideUp(250,function(){e.text("search"),n.empty(),r.trigger("blur")})}}]),a=o.rhythm_cat;new BabblingBrook.Client.Component.Selector("rhythm","config_rhythm_"+t,n,i,{show_fields:{domain:!1},initial_values:{rhythm_category:a}})}return e.text("close search"),n.slideDown(250).removeClass("hide"),!1})},f=function(e){console.error("There is an error in the users config settings. An invalid type is present : "+e)},g=function(e,n){if(-1!==BabblingBrook.Client.Settings.settings_to_show.indexOf(n.code))switch(n.type){case"rhythm_url":c(n);break;case"stream_url":i(n);break;case"uint":o(n);break;case"string":l(n);break;default:f(n.type)}},h=function(e,n){var r="";"string"==typeof n?r="A undefined error occured whilst updating this row. "+n:jQuery.each(n,function(e,n){r+=n+"<br>"}),jQuery(".config-row-error",e).html(r).removeClass("hide"),e.find(".config-value").removeClass("block-loading")},b=function(e,n,r,t){if("undefined"!=typeof t.error)return void h(e,t.error);e.find(".config-value").removeClass("block-loading");var o=u(n);"undefined"!=typeof BabblingBrook.Client.User.Config[n]&&BabblingBrook.Client.User.Config[n]===o?e.find(".config-value").removeClass("custom"):e.find(".config-value").addClass("custom")},y=function(){var e=jQuery(this),n=e.val(),r=e.parent(),t=r.find(".config-code").val();""===n&&(n=u(t),e.val(n)),jQuery(".config-row-error",r).addClass("hide"),e.addClass("block-loading"),BabblingBrook.Client.User.Config[t]=n,BabblingBrook.Client.Core.Interact.postAMessage({key:"user_config."+t,data:n},"StoreClientUserData",b.bind(null,r,t,n),h.bind(null,r))},p=function(n){jQuery.each(n,function(e,r){if(null!==r.extra_data){var t=BabblingBrook.Library.parseJSON(r.extra_data);n[e].extra_data=t}}),e=n,jQuery.each(n,g),d(),a(),jQuery(".config-value").blur(y)},v=function(){BabblingBrook.Client.Component.Messages.addMessage({type:"error",message:"An error occured whilst trying to fetch your user settings."})};return{construct:function(){BabblingBrook.Library.get("/"+BabblingBrook.Client.User.username+"/settings/get",{},p,v,"get_config_data_error"),BabblingBrook.Client.Core.Loaded.setSettingsLoaded()}}}(),jQuery(function(){"use strict";BabblingBrook.Client.Core.Loaded.onUserLoaded(function(){BabblingBrook.Client.Page.Settings.Settings.construct()})});
//# sourceMappingURL=/js/Minified/Client/Page/Settings/Settings.js.map