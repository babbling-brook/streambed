BabblingBrook.Client.Page.Mail=function(){"use strict";var e,t,o,i,n=0,a=jQuery.Deferred(),r=function(){return n++,n},l=function(){BabblingBrook.Client.Component.Messages.addMessage({type:"error",message:"Unable to retrieve some of your posts."})},s=function(e,t){var o=r(e);if(0===o)return void jQuery("#load_more").addClass("hide");jQuery("#load_more").removeClass("hide");var i={url:BabblingBrook.Library.changeUrlAction(BabblingBrook.Client.User.Config.default_private_filter,"json"),name:BabblingBrook.Library.extractName(BabblingBrook.Client.User.Config.default_private_filter),priority:BabblingBrook.Client.User.Config.default_private_filter_priority},n=BabblingBrook.Library.generateHashCode(e);BabblingBrook.Client.Core.Interact.postAMessage({sort_request:{type:e,client_uid:n,filter:i,moderation_rings:[],posts_to_timestamp:null,private_page:o,user:{username:BabblingBrook.Client.User.username,domain:BabblingBrook.Client.User.domain}}},"SortRequest",p.bind(null,e,o,t),l,BabblingBrook.Client.User.Config.action_timeout+5e3)},p=function(n,r,l,s){t===n&&(1===r&&(i=jQuery.extend({},BabblingBrook.Client.Component.PostsWaiting.getWaitingData()),a.resolve(),BabblingBrook.Client.Component.PostsWaiting.onInboxViewed(n)),s.sort_request.update===!1?l(s.posts):o.update(s.posts),e.removeClass("block-loading"))},b=function(e,o){a.done(function(){var n;"local_private"===t||"local_public"===t||"local_all"===t?"private"===o.status?n=i.private_client.timestamp:"public"===o.status&&(n=i.public_client.timestamp):"private"===o.status?n=i.private_global.timestamp:"public"===o.status&&(n=i.public_global.timestamp),parseInt(o.timestamp)>parseInt(n)&&e.addClass("new-post")})};return{construct:function(){},changeType:function(i){BabblingBrook.Client.Core.Loaded.onUserLoaded(function(){var a="#post_inbox_template>.post";("local_sent_private"===i||"global_sent_private"===i)&&(a="#post_sent_template>.post"),e=jQuery("#post_list"),t=i,e.empty(),n=0,o=new BabblingBrook.Client.Component.Cascade(e,a,s.bind(null,i),".post-replies",jQuery("#post_sent_template>.post"),b,void 0,void 0,s.bind(null,i))})}}}(),jQuery(function(){"use strict";BabblingBrook.Client.Core.Loaded.onUserLoaded(function(){BabblingBrook.Client.Page.Mail.construct()})});
//# sourceMappingURL=/js/Minified/Client/Page/Mail.js.map