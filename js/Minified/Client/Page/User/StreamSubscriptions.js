"object"!=typeof BabblingBrook.Client.Page.User&&(BabblingBrook.Client.Page.User={}),BabblingBrook.Client.Page.User.StreamSubscriptions=function(){"use strict";var e,t,r=!0,n=!0,i=function(e){e.stopPropagation();var t=jQuery(this).parent().parent().parent().attr("data-subscription-id"),r=v(t),n=jQuery(this).parent();n.addClass("selecting-version"),n.find(".change-version").addClass("hide"),n.find(".cancel-version-change").removeClass("hide");var i=jQuery("#Page_StreamSubscriptions_select_version_loading_template>option").clone();return n.find(".select-new-version").addClass("select-loading").prepend(i),n.find(".stream-version-selectors").removeClass("hide"),n.find(".version-description").addClass("hide"),BabblingBrook.Client.Core.Interact.postAMessage(r,"FetchStreamVersions",o.bind(null,n)),!1},a=function(e){e.stopPropagation();var t=jQuery(this).parent(),r=t.parent().parent(),n=r.attr("data-filter-id"),i=r.parent().parent().parent().parent(),a=i.attr("data-subscription-id"),s=y(a,n);t.addClass("selecting-version").find(".change-version").addClass("hide"),t.find(".cancel-version-change").removeClass("hide"),t.find(".filter-version-selectors").removeClass("hide");var l=jQuery("#Page_StreamSubscriptions_select_version_loading_template>option").clone();return t.find(".select-new-version").addClass("select-loading").prepend(l),t.find(".stream-version-selectors").removeClass("hide"),t.find(".version-description").addClass("hide"),BabblingBrook.Client.Core.Interact.postAMessage(s,"FetchRhythmVersions",o.bind(null,t)),!1},o=function(e,t){var r=e.find(".select-new-version"),n=e.find(".select-new-version.major-version"),i=e.find(".select-new-version.minor-version"),a=e.find(".select-new-version.patch-version");e.find(".option-loading").remove(),r.removeClass("select-loading");var o=e.find(".version-description").text(),s=o.split("/"),l=jQuery("<option>latest</option>");if("latest"===s[0]&&l.attr("selected","selected"),n.append(l),l=jQuery("<option>latest</option>"),"latest"===s[1]&&l.attr("selected","selected"),i.append(l),l=jQuery("<option>latest</option>"),"latest"===s[2]&&l.attr("selected","selected"),a.append(l),e.hasClass("stream-version-row")===!0){var d=jQuery("<option>all</option>");"all"===s[0]&&d.attr("selected","selected"),n.append(d),d=jQuery("<option>all</option>"),"all"===s[1]&&d.attr("selected","selected"),i.append(d),d=jQuery("<option>all</option>"),"all"===s[2]&&d.attr("selected","selected"),a.append(d)}var u,c,m,p={};jQuery.each(t.versions,function(e,t){var r=t.split("/");("undefined"==typeof u||u!==r[0])&&(p[r[0]]={},u=r[0],c=void 0,m=void 0),("undefined"==typeof c||c!==r[1])&&(p[r[0]][r[1]]={},c=r[1],m=void 0),("undefined"==typeof m||m!==r[2])&&(p[r[0]][r[1]][r[2]]={},m=r[2])}),jQuery.each(p,function(e,t){var r=jQuery("<option>");r.text(e),e===s[0]&&r.attr("selected","selected"),n.append(r),e===s[0]&&jQuery.each(t,function(e,t){var r=jQuery("<option>");r.text(e),e===s[1]&&r.attr("selected","selected"),i.append(r),e===s[1]&&jQuery.each(t,function(e){var t=jQuery("<option>");t.text(e),e===s[2]&&t.attr("selected","selected"),a.append(t)})})})},s=function(e){"undefined"!=typeof e&&e.stopPropagation(),jQuery(this).addClass("hide");var t=jQuery(this).parent();return t.removeClass("selecting-version").find(".change-version").removeClass("hide"),t.find(".select-new-version").find("option").not(".select-title").remove(),t.find(".major-version").parent().addClass("hide"),t.find(".version-description").removeClass("hide"),t.find(".cancel-version-change").addClass("hide"),!1},l=function(e,t,r,n){t.removeClass("selecting-version").find(".select-new-version").removeClass("select-loading").empty(),t.find(".version-description").text(e);var i=BabblingBrook.Library.makeResourceUrl(r,"",n);t.siblings("div.full-name").children("span.full-name").text(i),s.call(t.find(".cancel-version-change"))},d=function(e){e.stopPropagation();var t=jQuery(this),r=t.parent().parent(),n=r.parent().parent(),i=n.attr("data-filter-id"),a=n.parent().parent().parent().parent(),o=a.attr("data-subscription-id"),s=y(o,i),d=v(o),u=t.parent().find(".major-version"),c=t.parent().find(".minor-version"),m=t.parent().find(".patch-version"),p=jQuery("option:selected",u).text(),g=jQuery("option:selected",c).text(),b=jQuery("option:selected",m).text();t.hasClass("major-version")===!0&&(g="latest",b="latest"),t.hasClass("minor-version")===!0&&(b="latest");var f=p+"/"+g+"/"+b,h=BabblingBrook.Library.makeVersionObject(f);r.addClass("select-loading"),BabblingBrook.Client.Core.StreamSubscriptions.changeFilterVersion(o,i,h,d,s,l.bind(null,f,r,s,"rhythm"))},u=function(e){e.stopPropagation();var t=jQuery(this),r=t.parent().parent().parent().parent().attr("data-subscription-id"),n=v(r),i=t.parent().find(".major-version"),a=t.parent().find(".minor-version"),o=t.parent().find(".patch-version"),s=jQuery("option:selected",i).text(),d=jQuery("option:selected",a).text(),u=jQuery("option:selected",o).text();t.hasClass("major-version")===!0&&(d="latest",u="latest"),t.hasClass("minor-version")===!0&&(u="latest");var c=s+"/"+d+"/"+u,m=t.parent().parent();m.addClass("select-loading");var p=BabblingBrook.Library.makeVersionObject(c);BabblingBrook.Client.Core.StreamSubscriptions.changeStreamVersion(r,p,n,l.bind(null,c,m,n,"stream"))},c=function(e){var t=jQuery("#stream_subscription_unsubscribe_filter_template>li").clone();t.attr("data-filter-id",e.filter_subscription_id);var r=BabblingBrook.Library.makeRhythmUrl(e);t.attr("title",r),jQuery(".filter-name",t).text(e.name),e.locked===!0&&jQuery(".delete",t).addClass("hidden"),jQuery("#edit_streams ul.filters").append(t)},m=function(e){e.stopPropagation();var t=jQuery(this).parent(),r=t.parent().parent().parent().parent(),n=r.attr("data-subscription-id");if(jQuery("div.details",t).length)return jQuery("div.details",t).slideUp(250,function(){t.removeClass("open"),jQuery(this).remove()}),!1;jQuery("ul.filters>li").removeClass("open"),t.addClass("open"),jQuery("div.details",t).remove(),jQuery("#edit_streams ul.filters div.details").slideUp(250);var i,a=t.attr("data-filter-id"),o=BabblingBrook.Client.Core.StreamSubscriptions.getStreamSubscriptionFromId(n);i=o.filters[a],t.append('<div class="details"></div>');var s=jQuery("div.details:first",t);s.addClass("hide");var l=BabblingBrook.Library.makeRhythmUrl(i,""),d=jQuery("#subscription_filter_details_template>div").clone();jQuery(".full-name",d).text(l),jQuery(".filter-description",d).text(i.description);var u=BabblingBrook.Library.makeVersionString(i.version);return jQuery(".version-description",d).text(u),s.append(d),s.slideDown(250),!1},p=function(e){e.stopPropagation();var t=jQuery(this).parent(),r=t.attr("data-filter-id"),n=t.parent().parent().parent().parent(),i=n.attr("data-subscription-id"),a=v(i),o=y(i,r);return t.addClass("block-loading"),BabblingBrook.Client.Core.StreamSubscriptions.unSubscribeStreamFilter(i,r,a,o,function(){t.slideUp(250).remove()}),!1},g=function(e,t,r){var n=r.attr("data-subscription-id");r.addClass("block-loading"),BabblingBrook.Client.Core.StreamSubscriptions.subscribeStreamFilter(n,t,e,function(e){c(e.subscription),r.removeClass("block-loading")})},b=function(e){jQuery(".filter-search").slideUp(250,function(){jQuery(".search-new-filter",e).text("Search for a new filter").parent().removeClass("open block-loading"),jQuery(".filter-search").remove()})},f=function(e,t,r){jQuery(".filter-search").slideDown(250),jQuery(".search-new-filter").parent().removeClass("block-loading"),n===!0?BabblingBrook.Client.Core.Ajaxurl.changeUrl(window.location.href,"BabblingBrook.Client.Page.User.StreamSubscriptions.reconstructRhythmSearch",document.title,[e,r]):n=!0},y=function(e,t){var r;return jQuery.each(BabblingBrook.Client.User.StreamSubscriptions,function(n,i){return i.stream_subscription_id===e&&jQuery.each(i.filters,function(e,n){return n.filter_subscription_id===t?(r=n,!1):void 0}),"undefined"!=typeof r?!1:!0}),r},v=function(e){var t;return jQuery.each(BabblingBrook.Client.User.StreamSubscriptions,function(r,n){return n.stream_subscription_id===e?(t=n,!1):!0}),t},h=function(e,t,r){"undefined"!=typeof e&&e.stopPropagation();var n,i;"undefined"==typeof t?(i=jQuery(this).parent(),n=jQuery(this).parent().parent().parent().parent().parent(),t=n.attr("data-subscription-id")):(n=jQuery("#edit_streams>li[data-subscription-id="+t+"]"),i=n.find(".filter-search-opener"));var a=v(t);if(jQuery(".filter-suggestions").is(":visible")&&j(n),jQuery(".filter-search",n).length>0)return b(n),!1;i.addClass("open block-loading"),jQuery(".search-new-filter",n).text("Hide filter search"),i.append('<div class="filter-search" style="display:none;"></div>');{var o=[{name:"Subscribe",onClick:function(e,t,r){e.preventDefault();var i={domain:r.domain,username:r.username,name:r.name,version:{major:"latest",minor:"latest",patch:"latest"}};g(i,a,n),b(n),BabblingBrook.Client.Page.User.StreamSubscriptions.onRhythmSubscribedHook()}},{name:"Description",onClick:function(e,t,r){e.preventDefault();var n=t.next();n.hasClass("search-rhythm-description-row")===!0?jQuery(".search-rhythm-description",n).slideUp("fast",function(){n.remove()}):(jQuery(".selector-action-description",t).addClass("text-loading"),BabblingBrook.Client.Core.Interact.postAMessage({domain:r.domain,username:r.username,name:r.name,version:"latest/latest/latest"},"FetchRhythm",function(e){jQuery(".selector-action-description",t).removeClass("text-loading");var r=jQuery("#search_rhythm_description_template>tbody>tr").clone();jQuery(".search-rhythm-description",r).text(e.rhythm.description),t.after(r),jQuery(".search-rhythm-description",r).slideDown("fast").removeClass("hide")},function(){console.error("error fetching rhythm")}))}},{name:"View",onReady:function(e,t){var r=BabblingBrook.Library.makeRhythmUrl({domain:t.domain,username:t.username,name:t.name,version:t.version},"view");jQuery(".selector-action-view",e).attr("href","http://"+r)}}];new BabblingBrook.Client.Component.Selector("rhythm","filter",jQuery(".filter-search"),o,{show_fields:{version:!1},initial_values:{rhythm_category:"sort"},onReady:f.bind(null,t,n),additional_selector_class:"selector-2"},r)}return!1},j=function(e){jQuery(".filter-suggestions",e).slideUp(250,function(){jQuery(".filter-suggest-opener",e).removeClass("open block-loading"),jQuery(".suggest-new-filter",e).text("Show filter suggestions"),jQuery(".filter-suggestions",e).remove()})},Q=function(e,t,r,i){var a=jQuery(".filter-suggestions",r);if(0===i.length){var o=jQuery("#no_suggestions_template>div").clone();a.append(o)}var s=a.find(".filter-suggestions-table");jQuery.each(i,function(e,n){var i=BabblingBrook.Library.makeRhythmUrl(n,"view"),a=jQuery("#subscription_filter_suggestion_table_template>tbody>tr").clone();a.attr("data-filter-name",n.name),a.attr("data-filter-domain",n.domain),a.attr("data-filter-username",n.username),a.attr("data-filter-version",n.version),jQuery(".view-suggestion-filter",a).attr("href","http://"+i),jQuery(".rhythm",a).attr("title",i),jQuery(".rhythm",a).text(n.name),s.append(a),jQuery(".add-suggestion-filter").click(function(){var e={domain:a.attr("data-filter-domain"),username:a.attr("data-filter-username"),name:a.attr("data-filter-name"),version:{major:"latest",minor:"latest",patch:"latest"}};return g(e,t,r),j(r),!1}),jQuery(".view-suggestion-filter").click(function(){var e=jQuery(this).parent().parent(),t=BabblingBrook.Library.makeRhythmUrl({domain:e.attr("data-filter-domain"),username:e.attr("data-filter-username"),name:e.attr("data-filter-name"),version:"latest/latest/latest"},"view");return BabblingBrook.Client.Core.Ajaxurl.redirect(t),!1})}),a.parent().slideDown(250,function(){jQuery(".filter-suggest-opener",r).removeClass("block-loading")}),n===!0?BabblingBrook.Client.Core.Ajaxurl.changeUrl(window.location.href,"BabblingBrook.Client.Page.User.StreamSubscriptions.reconstructRhythmSuggestions",document.title,[e]):n=!0},C=function(e,t){"undefined"!=typeof e&&e.stopPropagation();var r;"undefined"==typeof t?(r=jQuery(this).parent().parent().parent().parent().parent(),t=r.attr("data-subscription-id")):r=jQuery("#edit_streams>li[data-subscription-id="+t+"]");var n=r.find(".filter-suggest-opener"),i=v(t);if(jQuery(".filter-search").is(":visible")&&b(r),jQuery(".filter-suggestions").is(":visible")||jQuery(".filter-suggest-opener",r).hasClass("block-loading"))return j(r),!1;var a=jQuery("#subscription_filter_suggestion_template>div").clone();return n.addClass("open block-loading").append(a).find(".suggest-new-filter").text("Hide rhythm suggestions"),BabblingBrook.Client.Core.Suggestion.fetch("stream_filter_suggestion",Q.bind(null,t,i,r),{domain:i.domain,username:i.username,name:i.name,version:BabblingBrook.Library.makeVersionString(i.version)}),!1},_=function(e){var t=jQuery("#moderation_line_template>li").clone(),r=e.domain+"/"+e.username;t.attr("title",r),jQuery(".ring-name",t).text(e.username),t.attr("data-ring-subscription-id",e.ring_subscription_id),jQuery(".details",t).attr("href","http://"+r+"/profile"),jQuery("#edit_streams ul.moderation-rings").append(t)},k=function(e){"undefined"!=typeof e&&e.stopPropagation();var t=jQuery(this).parent(),r=t.attr("data-ring-subscription-id"),n=t.parent().parent().parent().parent(),i=n.attr("data-subscription-id"),a=v(i),o=t.attr("title"),s=o.split("/"),l={domain:s[0],username:s[1]};t.addClass("block-loading"),BabblingBrook.Client.Core.StreamSubscriptions.unsubscribeStreamModerationRing(i,r,a,l,function(){t.slideUp(250).remove()})},B=function(e,t,r){BabblingBrook.Client.Core.StreamSubscriptions.subscribeStreamModerationRing(t,e,r,function(e){_(e.subscription)})},S=function(){jQuery("#edit_streams .moderation-suggestions").slideUp(250,function(){jQuery("#edit_streams .suggest-new-moderation-ring").text("Show moderation suggestions").parent().removeClass("open block-loading"),jQuery("#edit_streams .moderation-suggestions").remove()})},w=function(e,t,r,i,a){var o=jQuery("#edit_streams #moderation_suggestions");if(0===a.length){var s=jQuery("#no_suggestions_template>div").clone();jQuery(".moderation-suggestions",r).append(s)}jQuery.each(a,function(e,t){var r=jQuery("#moderation_ring_suggetstion_line_template>tbody>tr").clone();r.attr("data-ring-name",t.username),r.attr("data-ring-domain",t.domain),jQuery(".view-suggested-moderation-ring",r).attr("href","http://"+t.domain+"/"+t.username),jQuery(".ring",r).attr("title",t.domain+"/"+t.username).text(t.username),o.append(r)}),jQuery(".add-suggested-moderation-ring").click(function(){var n=jQuery(this).parent().parent(),i={domain:n.attr("data-ring-domain"),username:n.attr("data-ring-name")};return B(t,e,i,r),S(r),!1}),jQuery(".join-moderation-ring-filter").click(function(){var e=jQuery(this).parent().parent(),t=e.attr("data-ring-name"),r=e.attr("data-ring-domain"),n="http://"+r+"/"+t+"/profile";return BabblingBrook.Client.Core.Ajaxurl.redirect(n),!1}),o.parent().slideDown(250,function(){o.parent().parent().removeClass("block-loading")}),n===!0?BabblingBrook.Client.Core.Ajaxurl.changeUrl(window.location.href,"BabblingBrook.Client.Page.User.StreamSubscriptions.reconstructRingSuggestions",document.title,[e]):n=!0},x=function(e,t){"undefined"!=typeof e&&e.stopPropagation();var r;"undefined"==typeof t?(r=jQuery(this).parent().parent().parent().parent().parent(),t=r.attr("data-subscription-id")):r=jQuery("#edit_streams>li[data-subscription-id="+t+"]");var n=r.find(".suggestion-moderation-rings-opener"),i=v(t);if(n.hasClass("open")===!0)return S(r),!1;n.hasClass("open")===!0&&U(r);var a=jQuery("#moderation_ring_suggestion_container_template>div").clone();return jQuery("table",a).attr("id","moderation_suggestions"),n.append(a).addClass("open block-loading").find("#edit_streams .suggest-new-moderation-ring").text("Hide moderation suggestions"),BabblingBrook.Client.Core.Suggestion.fetch("stream_ring_suggestion",w.bind(null,t,i,r,n),{domain:i.domain,username:i.username,name:i.name,version:BabblingBrook.Library.makeVersionString(i.version)}),!1},U=function(e){jQuery("#moderation_ring_search",e).slideUp(250,function(){jQuery(".search-moderation-rings-opener",e).removeClass("open block-loading"),jQuery(".search-new-moderation-ring",e).text("Search for a moderation ring"),jQuery("#moderation_ring_search",e).remove()})},R=function(e,t){jQuery("#moderation_ring_search").slideDown(250),jQuery("#edit_streams .search-new-moderation-ring").parent().removeClass("block-loading"),n===!0?BabblingBrook.Client.Core.Ajaxurl.changeUrl(window.location.href,"BabblingBrook.Client.Page.User.StreamSubscriptions.reconstructRingSearch",document.title,[e,t]):n=!0},P=function(e,t,r){"undefined"!=typeof e&&e.stopPropagation();var n;"undefined"==typeof t?(n=jQuery(this).parent().parent().parent().parent().parent(),t=n.attr("data-subscription-id")):n=jQuery("#edit_streams>li[data-subscription-id="+t+"]");var i=n.find(".search-moderation-rings-opener"),a=v(t);if(jQuery(".suggestion-moderation-rings-opener",n).hasClass("open")&&S(n),i.hasClass("open")===!0)return U(),!1;i.addClass("open block-loading"),jQuery(".search-new-moderation-ring",i).text("Hide moderation ring search"),i.append('<div id="moderation_ring_search" style="display:none;"></div>');{var o=jQuery("#moderation_ring_search"),s=[{name:"Subscribe",onClick:function(e,r){e.preventDefault();var i={domain:jQuery(".domain",r).text(),username:jQuery(".username",r).text()};B(a,t,i,n),U(),BabblingBrook.Client.Page.User.StreamSubscriptions.onModerationRingSubscribedHook()},onReady:function(e,t){var r=!1,n=t.domain+"/"+t.username;jQuery.each(a.rings,function(e,t){var i=t.domain+"/"+t.username;i===n&&(r=!0)}),r===!0&&jQuery(".selector-action-subscribe",e).addClass("hidden")}},{name:"View",onReady:function(e,t){var r="http://"+t.domain+"/"+t.username+"/profile";jQuery(".selector-action-view",e).attr("href",r)}}];new BabblingBrook.Client.Component.Selector("user","moderation_ring_search",o,s,{initial_values:{user_type:"ring"},onReady:R.bind(null,t),user_type:"ring",additional_selector_class:"selector-2"},r)}return!1},L=function(e,t){"undefined"!=typeof e&&e.stopPropagation(),"string"!=typeof t&&(t=jQuery(this).parent().attr("data-subscription-id"));var n=jQuery("#edit_streams>li[data-subscription-id="+t+"]");if(n.hasClass("opening")===!0)return!1;if(n.hasClass("open")===!0)return jQuery("div.details",n).slideUp(250,function(){n.removeClass("opening").removeClass("open",250),jQuery(this).remove()}),!1;n.addClass("opening").toggleClass("open",250,function(){n.removeClass("opening")}),jQuery("div.details",n).remove(),jQuery("#edit_streams>li>div.details").not(n).slideUp(250,function(){jQuery(this).parent().toggleClass("open",250),jQuery(this).remove()}),jQuery(".filter-options",n).remove();var i=v(t);n.append('<div class="details"></div>');var a=jQuery("div.details:first",n);a.addClass("hide");var o=BabblingBrook.Library.makeStreamUrl(i),s=jQuery("#stream_details_line_template>div").clone();jQuery("span.full-name",s).text(o),jQuery(".stream-description",s).text(i.description);var l=BabblingBrook.Library.makeVersionString(i.version);return jQuery(".version-description",s).text(l),a.append(s),BabblingBrook.Settings.feature_switches.CHANGE_STREAM_MODERATION_RING===!1&&jQuery(".moderation-block",a).addClass("hide"),jQuery.each(i.filters,function(e,t){c(t)}),jQuery.each(i.rings,function(e,t){_(t)}),a.slideDown(250).removeClass("hide"),a.parent().removeClass("block-loading"),r===!0?BabblingBrook.Client.Core.Ajaxurl.changeUrl(window.location.href,"BabblingBrook.Client.Page.User.StreamSubscriptions.reconstructStreamSubscription",document.title,[t]):r=!0,!1},D=function(e){var t=jQuery("#subscribed_line_template>li").clone();t.attr("data-subscription-id",e.stream_subscription_id),jQuery(".stream-name",t).text(e.name),e.locked===!0&&jQuery(".delete",t).addClass("hidden"),jQuery("#edit_streams").append(t)},A=function(e,t,r,n,i){i.addClass("block-loading");var a={name:e,domain:t,username:r,version:BabblingBrook.Library.makeVersionObject(n)};BabblingBrook.Client.Core.StreamSubscriptions.subscribeStream(a,function(e){i.removeClass("block-loading"),D(e.subscription),BabblingBrook.Client.Page.User.StreamSubscriptions.onStreamSubscribedHook()})},V=function(){var e=jQuery("#stream_suggestions_opener_message_template").text(),r=jQuery("#stream_suggestions_closer_message_template").text(),n=jQuery("#stream_suggestions_opener");t=new BabblingBrook.Client.Component.Suggestions(n,e,r,"stream_suggestion","streams_to_subscribe","BabblingBrook.Client.Page.User.StreamSubscriptions.reconstructStreamSuggestions",[{name:"Subscribe",onClick:function(e,t){A(e.name,e.domain,e.username,"latest/latest/latest",t)}},{name:"Description",onClick:function(e,t){var r=t.next();r.hasClass("search-stream-description-row")===!0?jQuery(".search-stream-description",r).slideUp("fast",function(){r.remove()}):(jQuery(".selector-action-description",t).addClass("text-loading"),BabblingBrook.Client.Core.Interact.postAMessage({stream:{domain:e.domain,username:e.username,name:e.name,version:e.version}},"FetchStream",function(e){jQuery(".selector-action-description",t).removeClass("text-loading");var r=jQuery("#search_stream_description_template>tbody>tr").clone();jQuery(".search-stream-description",r).text(e.description),t.after(r),jQuery(".search-stream-description",r).slideDown("fast").removeClass("hide")},function(){console.error("error fetching stream")}))}},{name:"View",onClick:function(e){var t=BabblingBrook.Library.makeStreamUrl(e,"");BabblingBrook.Client.Core.Ajaxurl.redirect(t)}}])},H=function(t){BabblingBrook.Client.Page.User.StreamSubscriptions.onStreamSearchOpenedHook();{var r=[{name:"Subscribe",onClick:function(e,t){e.preventDefault();var r=jQuery(".name",t).text(),n=jQuery(".domain",t).text(),i=jQuery(".username",t).text();A(r,n,i,"latest/latest/latest",t)}},{name:"Description",onClick:function(e,t){e.preventDefault();var r=t.next();if(r.hasClass("search-stream-description-row")===!0)jQuery(".search-stream-description",r).slideUp("fast",function(){r.remove()});else{var n=jQuery(".name",t).text(),i=jQuery(".domain",t).text(),a=jQuery(".username",t).text();jQuery(".selector-action-description",t).addClass("text-loading"),BabblingBrook.Client.Core.Interact.postAMessage({stream:{domain:i,username:a,name:n,version:"latest/latest/latest"}},"FetchStream",function(e){jQuery(".selector-action-description",t).removeClass("text-loading");var r=jQuery("#search_stream_description_template>tbody>tr").clone();jQuery(".search-stream-description",r).text(e.streams[0].description),t.after(r),jQuery(".search-stream-description",r).slideDown("fast").removeClass("hide")},function(){console.error("error fetching stream")})}}},{name:"View",onReady:function(e,t){var r=BabblingBrook.Library.makeStreamUrl(t,"",!1);jQuery(".selector-action-view",e).attr("href",r)}}];new BabblingBrook.Client.Component.Selector("stream","stream",jQuery("#stream_search_container"),r,{initial_values:{rhythm_category:"sort",domain:window.location.hostname},onReady:e.onChange,onBeforeRedraw:e.onBeforeChange,show_fields:{version:!1},additional_selector_class:"selector-2"},t)}return!1},M=function(e){e.stopPropagation();var t=jQuery(this).parent();if(t.hasClass("block-loading")===!0)return!1;var r=jQuery(this).parent().attr("data-subscription-id"),n=v(r);return t.addClass("block-loading"),BabblingBrook.Client.Core.StreamSubscriptions.unsubscribeStream(n,r,function(){t.removeClass("block-loading"),t.slideUp(250,function(){t.remove()})}),!1};return{construct:function(){BabblingBrook.Client.Core.Loaded.onStreamSubscriptionsLoaded(function(){jQuery.each(BabblingBrook.Client.User.StreamSubscriptions,function(e,t){D(t)}),BabblingBrook.Client.Core.Loaded.setStreamSubscriptionsPageLoaded();var t=jQuery("#stream_search_opener_message_template").text(),r=jQuery("#stream_search_closer_message_template").text();e=new BabblingBrook.Client.Component.TableOpenerUX(t,r,jQuery("#stream_search_opener"),jQuery("#stream_search_container"),"#selector_stream",H.bind(null,1),"BabblingBrook.Client.Page.User.StreamSubscriptions.reconstructStreamSearch"),V(),jQuery("#page").on("click","#edit_streams>li>a.details",L),jQuery("#page").on("click","#edit_streams>li>a.delete",M),jQuery("#edit_streams").on("click",".stream-version-row .change-version",i),jQuery("#edit_streams").on("click",".cancel-version-change",s),jQuery("#edit_streams").on("change",".stream-versions",u),jQuery("#edit_streams").on("click",".filter-details",m),jQuery("#edit_streams").on("click",".filter-version-row .change-version",a),jQuery("#edit_streams").on("change",".filter-versions",d),jQuery("#edit_streams").on("click",".filter-delete",p),jQuery("#edit_streams").on("click",".suggest-new-filter",C),jQuery("#edit_streams").on("click",".search-new-filter",h),jQuery("#edit_streams").on("click",".search-new-moderation-ring",P),jQuery("#edit_streams").on("click",".moderation-rings .delete",k),jQuery("#edit_streams").on("click",".suggest-new-moderation-ring",x)})},reconstructStreamSearch:function(e){r=!1,H(e)},reconstructStreamSuggestions:function(){r=!1,t.autoOpen()},reconstructRhythmSuggestions:function(e){r=!1,n=!1,L(void 0,e),C(void 0,e)},reconstructRingSuggestions:function(e){r=!1,n=!1,L(void 0,e),x(void 0,e)},reconstructStreamSubscription:function(e){r=!1,L(void 0,e)},reconstructRhythmSearch:function(e,t){r=!1,n=!1,L(void 0,e),h(void 0,e,t)},reconstructRingSearch:function(e,t){r=!1,n=!1,L(void 0,e),P(void 0,e,t)},onStreamSubscribedHook:function(){},onRhythmSubscribedHook:function(){},onStreamSearchOpenedHook:function(){},openStreamSearch:function(){H(1)},onModerationRingSubscribedHook:function(){}}}(),jQuery(function(){"use strict";BabblingBrook.Client.Page.User.StreamSubscriptions.construct(),jQuery("#choose_stream a.suggestions").trigger("click")});
//# sourceMappingURL=/js/Minified/Client/Page/User/StreamSubscriptions.js.map