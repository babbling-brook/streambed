"object"!=typeof BabblingBrook.Client.Page.ManageStream&&(BabblingBrook.Client.Page.ManageStream={}),BabblingBrook.Client.Page.ManageStream.Update=function(){"use strict";var e=function(){jQuery("#new_version").click(function(){jQuery("#new_version_loading").css({visibility:"visible"});var e=BabblingBrook.Library.changeUrlAction(window.location.pathname,"newversion"),r=jQuery("#version option:selected").val();BabblingBrook.Library.post(e,{new_version:r},function(e){if("undefined"!=typeof e.error&&(jQuery("#new_version_error").html(e.error).removeClass("hide"),jQuery("#new_version_success").addClass("hide")),"undefined"!=typeof e.url){var a=jQuery("#new_stream_version_template").clone();jQuery(".new-stream-version-url",a).attr("href",e.url),jQuery("#new_version_success").html(a.html()).removeClass("hide"),jQuery("#new_version_error").addClass("hide");var t=jQuery("<option>");t.val(r).text(r),jQuery("#sidebar select#versions").append(t)}jQuery("#new_version_loading").css({visibility:"hidden"})},"json")})},r=function(){jQuery("#duplicate").click(function(){jQuery("#duplicate_loading").css({visibility:"visible"}),BabblingBrook.Library.post(window.location.pathname,{duplicate_name:jQuery("#duplicate_name").val()},function(e){if("undefined"!=typeof e.error)return jQuery("#duplicate_error").html(e.error).removeClass("hide"),void jQuery("#duplicate_success").addClass("hide");if(null!==e.url){var r=jQuery("#stream_duplicated_template").clone();jQuery(".duplicated-stream-url",r).attr("href",e.url),jQuery("#duplicate_success").html(r.html()).removeClass("hide"),jQuery("#duplicate_error").addClass("hide")}jQuery("#duplicate_loading").css({visibility:"hidden"})},"json")})},a=function(e,r){if(r.success===!1)s(r.error);else switch(r.deletable===!0?(jQuery(".revert").removeClass("hide"),jQuery(".delete").removeClass("hide")):(jQuery(".revert").addClass("hide"),jQuery(".delete").addClass("hide")),e){case"publish":jQuery(".stream_status").text("Public"),jQuery(".publish").addClass("hide"),jQuery(".deprecate").removeClass("hide"),jQuery(".stream_status").text("public"),jQuery('#version option[value="No change"]').remove(),jQuery("#ajax_load").removeClass("ajax-loading");break;case"deprecate":jQuery(".stream_status").text("Deprecated"),jQuery(".publish").removeClass("hide"),jQuery(".deprecate").addClass("hide"),jQuery(".stream_status").text("deprecated"),jQuery("#ajax_load").removeClass("ajax-loading");break;case"delete":jQuery("#stream_form").html(""),jQuery("#stream_details_operation").remove(),jQuery("#update_stream_operation").remove(),jQuery("#edit_stream_operation").remove(),jQuery("#edit_stream_fields_operation").remove(),jQuery("#stream_posts_operation").remove(),jQuery("#stream_spacer_operation").remove(),jQuery("#switch_version_operation").remove(),jQuery("#stream_overview").html("This stream has been deleted."),jQuery("#ajax_load").removeClass("ajax-loading");break;case"revert":jQuery(".stream_status").text("Private"),jQuery(".publish").removeClass("hide"),jQuery(".deprecate").addClass("hide"),jQuery(".revert").addClass("hide"),jQuery(".stream_status").text("private")}},t=function(e){var r=BabblingBrook.Library.changeUrlAction(window.location.pathname,"changestatus");BabblingBrook.Library.post(r,{action:e},a.bind(null,e),s.bind(null,"Error requesting status change for "+r))},s=function(e){throw e},i=function(){jQuery("#stream_status_actions .publish").click(function(){var e=jQuery.trim(jQuery(".stream_status").text());if("private"===e){var r="Are you sure? You will not be able to edit the stream once a user has made a post in your stream. You can make test posts without publishing by clicking on the 'posts' link  to the right. (You will be able to edit your stream by creating a new version.)";if(!confirm(r))return}jQuery("#ajax_load").addClass("ajax-loading"),t("publish")}),jQuery("#stream_status_actions .delete").click(function(){jQuery("#ajax_load").addClass("ajax-loading"),confirm("Are you sure? Deleted Streams are not recoverable.")&&t("delete")}),jQuery("#stream_status_actions .deprecate").click(function(){jQuery("#ajax_load").addClass("ajax-loading"),t("deprecate")}),jQuery("#stream_status_actions .revert").click(function(){jQuery("#ajax_load").addClass("ajax-loading"),t("revert")})},o=function(){jQuery("#post_mode").change(function(){var e=jQuery(this).val();jQuery("#post_mode").addClass("textbox-loading"),BabblingBrook.Library.post(jQuery("#update_url").val()+"postmode",{post_mode_id:e,stream_extra_id:jQuery("#StreamExtra_stream_extra_id").val()},function(e){e.success===!0&&jQuery("#post_mode").removeClass("textbox-loading")})})};return{construct:function(){i(),r(),e(),o()}}}(),jQuery(function(){"use strict";BabblingBrook.Client.Page.ManageStream.Update.construct()});
//# sourceMappingURL=/js/Minified/Client/Page/ManageStream/Update.js.map